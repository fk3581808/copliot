<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Traffic Capture</title>
  <script>
    const FORM_ACTION = "https://docs.google.com/forms/d/e/1FAIpQLSdMVH6rsGtas1HFxL6ada_tr7sQxFs5iQTspgq8sp0iSpZV7A/formResponse";
    const FIELD_IDS = {
      siteid: "entry.897794614",
      country: "entry.577451125",
      os: "entry.937726090",
      device: "entry.912828124",
      browser: "entry.760224698",
      connection: "entry.1309151960",
      isBot: "entry.956650261",
      status: "entry.1336793015"
    };

    function getQueryParams() {
      const params = {};
      window.location.search.substring(1).split("&").forEach(pair => {
        const [key, value] = pair.split("=");
        if (key && value) {
          params[decodeURIComponent(key)] = decodeURIComponent(value);
        }
      });
      console.log("Query Parameters:", params);
      return params;
    }

    function isLikelyBot() {
      const ua = navigator.userAgent || "";
      const suspiciousUA = /(bot|crawl|spider|google|baidu|yandex|bing|duckduck|slurp|curl|wget|httpclient|python|java|apex|go-http|phantom|headless|selenium|puppeteer|scrapy|httpx|okhttp|feedfetcher|simplepie)/i.test(ua);
      const automation = navigator.webdriver === true || window._phantom || window.callPhantom || window.__nightmare || window.nightmare;
      const isHeadless = ua.includes('HeadlessChrome') || window.chrome === undefined || window.navigator.plugins.length === 0;
      const pluginsEmpty = (navigator.plugins && navigator.plugins.length === 0);
      const languagesEmpty = !navigator.languages || navigator.languages.length === 0;
      const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
      const touchMismatch = (hasTouch && /windows|mac|linux/i.test(ua) && !/android|iphone|ipad|mobile/i.test(ua));
      const screenMismatch = window.screen && (window.screen.width === 0 || window.screen.height === 0);
      let minimalNavigator = false;
      try {
        minimalNavigator = Object.keys(navigator).length < 5;
      } catch (e) {}

      // Log details
      console.log("User-Agent:", ua);
      console.log("navigator.webdriver:", navigator.webdriver);
      console.log("window.chrome:", window.chrome);
      console.log("navigator.plugins.length:", navigator.plugins ? navigator.plugins.length : "N/A");
      console.log("navigator.languages:", navigator.languages);
      console.log("hasTouch:", hasTouch);
      console.log("touchMismatch:", touchMismatch);
      console.log("screenMismatch:", screenMismatch);
      console.log("minimalNavigator:", minimalNavigator);
      console.log("suspiciousUA:", suspiciousUA);
      console.log("automation:", automation);
      console.log("isHeadless:", isHeadless);
      console.log("pluginsEmpty:", pluginsEmpty);
      console.log("languagesEmpty:", languagesEmpty);

      return suspiciousUA || automation || isHeadless || pluginsEmpty || languagesEmpty || touchMismatch || screenMismatch || minimalNavigator;
    }

    async function getProxyOrVPNStatus() {
      try {
        const res = await fetch("https://ipapi.co/json/");
        if (!res.ok) {
          console.log("ipapi.co fetch failed or returned non-ok status.");
          return {country: "unknown", proxy: false, asn: "", org: ""};
        }
        const json = await res.json();
        const org = (json.org || '').toLowerCase();
        const asn = (json.asn || '').toLowerCase();
        const host = (json.hosting || false);
        const proxy = (json.proxy || false);
        const vpn = (json.vpn || false);
        const isProxy = proxy || vpn || host ||
            org.includes('vpn') || org.includes('proxy') || org.includes('hosting') || org.includes('cloud') ||
            asn.includes('vpn') || asn.includes('proxy') || asn.includes('hosting') || asn.includes('cloud');
        console.log("ipapi.co response:", json);
        console.log("Proxy/VPN/Hosting Detection: proxy:", proxy, "vpn:", vpn, "hosting:", host, "org:", org, "asn:", asn, "isProxy:", isProxy);
        return {country: json.country || "unknown", proxy: isProxy, asn, org};
      } catch (e) {
        console.log("ipapi.co error:", e);
        return {country: "unknown", proxy: false, asn: "", org: ""};
      }
    }

    function isSpoofed() {
      const ua = navigator.userAgent || "";
      const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
      let spoofed = false;
      if (hasTouch && /windows|mac|linux/i.test(ua) && !/android|iphone|ipad|mobile/i.test(ua)) spoofed = true;
      if ((navigator.platform || "").toLowerCase().includes("win") && (navigator.maxTouchPoints || 0) > 0) spoofed = true;
      if (Object.keys(navigator).length < 5) spoofed = true;

      console.log("isSpoofed check: hasTouch:", hasTouch, "ua:", ua, "spoofed:", spoofed);
      return spoofed;
    }

    async function main() {
      const params = getQueryParams();
      const botDetected = isLikelyBot();
      const spoofed = isSpoofed();
      const proxyInfo = await getProxyOrVPNStatus();

      let statusFlags = [];
      if (botDetected) statusFlags.push("Bot");
      if (spoofed) statusFlags.push("Spoofed");
      if (proxyInfo.proxy) statusFlags.push("Proxy/VPN");
      if (statusFlags.length === 0) statusFlags.push("Real");

      const data = {
        siteid: params.siteid || "unknown",
        country: params.cc || proxyInfo.country || "unknown",
        os: params.operatingsystem || "unknown",
        device: params.device || "unknown",
        browser: navigator.userAgent,
        connection: params.connection || "unknown",
        isBot: botDetected ? "true" : "false",
        status: statusFlags.join(", ")
      };

      console.log("Final Data to send:", data);

      try {
        const formData = new FormData();
        for (const key in data) {
          formData.append(FIELD_IDS[key], data[key]);
        }
        navigator.sendBeacon(FORM_ACTION, formData);
        console.log("Data sent to Google Form.");
      } catch (e) {
        console.log("Error sending data to Google Form:", e);
      }

      document.body.innerHTML = "<div style='display:flex;justify-content:center;align-items:center;height:100vh;font-size:2rem;'>Data sent correctly<br>Status: " + data.status + "</div>";
      document.body.style.display = "block";
    }

    window.onload = main;
  </script>
  <style>body{display:none;background:#fff;color:#2c3e50;}</style>
</head>
<body></body>
</html>
